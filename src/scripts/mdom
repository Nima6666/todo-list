import Render from "./render";
import { compareAsc, format } from 'date-fns'
import { Project, listOfProjects } from "./project";
import { Task } from "./task";
import { da } from "date-fns/locale";
import { render } from "sass";

const mDom = (() => {
    const content = document.querySelector('.content');
    let contentTexts = "";

    const checkPriority = () => {
        for(let i = 0; i < listOfProjects.length; i++) {
            if (listOfProjects[i].priority == "high") {
                (document.querySelector(`.project${i}`)).setAttribute('style', 'background: rgba(255, 0, 0, 0.7)');
            } else if (listOfProjects[i].priority == "medium") {
                (document.querySelector(`.project${i}`)).setAttribute('style', 'background: rgba(255, 0, 0, 0.3)');
            }
        }
    }


    const fillProjects = (list, i) => {

        contentTexts += `

                    <div class="project${i}">
                        <button id = ${i}>Del</button>
                        <button id = e${i}>Edit</button>
                        <h2 class="name">${list[i].projectName}</h2>
                        <div class="name">${list[i].date}</div>

                    </div>
        
        `;
        content.innerHTML = contentTexts;


    };

    const resetCotext = () => {
        contentTexts = "";
    };

    const resetContent = () => {
        content.textContent = "";
    }

    return {
        fillProjects,
        resetCotext,
        checkPriority,
        resetContent
    }



})();


const buttonHandler = (() => {
    const dvForm = document.querySelector('.form');
    
    function cross() {
        dvForm.classList.remove('active');
    }

    const addP = () => {

        dvForm.classList.add('active');
        const crossBtn = document.querySelector('#cross');
        crossBtn.addEventListener('click', cross);

    } 

    const submit = () => {
        let date = (document.querySelector('#date').value)
        date = date.split('-');
        date = format(new Date(date[0], date[1], date[2]), 'eeee yyyy-MM-dd');
        const newProjt = new Project(document.querySelector('#project').value, document.querySelector('#note').value, date, (document.querySelector('#priority').value));
        (document.querySelector('form')).reset();
        Render.fillProjects();
        cross();
    }

    const lside = (ev) => {
        (document.querySelectorAll('.lside > *')).forEach((comp) => {
            comp.classList.value ? comp.classList.remove('active') : 0;
        })
        ev.target.classList.add('active');
        (document.querySelector('.content')).id = (ev.target.innerHTML.split(' ').join('')).toLowerCase();

        if (document.querySelector('.content').id == 'alltasks') {

            mDom.resetContent();
            Render.fillTasks();

        } else if (document.querySelector('.content').id == 'allprojects') {

            mDom.resetContent();
            Render.fillProjects();

        } else if (document.querySelector('.content').id == 'donetasks') {

            mDom.resetContent();
            Render.fillDoneTasks();

        } else {
            mDom.resetContent();
            Render.fillDueTasks();
        }

    }
    

    return {
        addP,
        submit,
        lside
    }

})()


const newProject = document.querySelector('#addProject');
const form = document.querySelector('form');
const lside = document.querySelectorAll('.lside > *');


lside.forEach((side) => side.addEventListener('click', buttonHandler.lside));

form.addEventListener('submit', buttonHandler.submit);

newProject.addEventListener('click', buttonHandler.addP);


export default mDom;